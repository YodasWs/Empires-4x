"use strict";(()=>{var e={357:()=>{"use strict";function e(e,n,r){t(e,n),n.set(e,r)}function t(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function n(e,t,n){return e.set(i(e,t),n),n}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(s=function(){return!!e})()}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){m(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y(r.key),r)}}function d(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t,n){return(t=y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){var t=function(e){if("object"!=v(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==v(t)?t:t+""}function p(e,t){if(e){if("string"==typeof e)return g(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}var w=function(e){return Number.isFinite(e)&&!Number.isNaN(e)},b=function(e){return"object"==v(e)&&null!==e},x=function(e){return b(e)&&w(e.col)&&w(e.row)},k=function(e){return Array.isArray(e)&&w(e[0])&&w(e[1])},O=function(e,t){return t+e*(1&t)>>1},S=function(e,t){return function(e){return(e%8+8)%8}(e+t)},T=function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,s,a=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,3),n=t[0],r=t[1],i=t[2];return{q:n,r,s:void 0===i?-n-r:i}};function E(e){var t=e.q,n=e.r,r=e.s,i=w(t),o=w(n),s=w(r);if(i&&o&&s)return{q:t,r:n,s:r};if(i&&o)return{q:t,r:n,s:-t-n};if(i&&s)return{q:t,r:-t-r,s:r};if(o&&s)return{q:-n-r,r:n,s:r};throw new TypeError("Can't determine three cube coordinates from less than two coordinates. Received: { q: ".concat(t,", r: ").concat(n,", s: ").concat(r," }."))}var P=function(e){return e.FLAT="FLAT",e.POINTY="POINTY",e}(P||{});var C=function(){return d(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];h(this,e),m(this,"q",void 0),m(this,"r",void 0);var n=L(this,t),r=n.q,i=n.r;this.q=r,this.r=i},[{key:"center",get:function(){var e=this.width,t=this.height;return{x:e/2-this.x,y:t/2-this.y}}},{key:"col",get:function(){return U(this).col}},{key:"corners",get:function(){var e=this.orientation,t=this.width,n=this.height,r=this.x,i=this.y;return e===P.POINTY?q(t,n,r,i):A(t,n,r,i)}},{key:"dimensions",get:function(){return j.dimensions}},{key:"height",get:function(){var e=this.orientation,t=this.dimensions.yRadius;return e===P.POINTY?2*t:t*Math.sqrt(3)}},{key:"isFlat",get:function(){return this.orientation===P.FLAT}},{key:"isPointy",get:function(){return this.orientation===P.POINTY}},{key:"orientation",get:function(){return j.orientation}},{key:"origin",get:function(){return j.origin}},{key:"offset",get:function(){return j.offset}},{key:"row",get:function(){return U(this).row}},{key:"width",get:function(){var e=this.orientation,t=this.dimensions.xRadius;return e===P.POINTY?t*Math.sqrt(3):2*t}},{key:"x",get:function(){return N(this).x}},{key:"y",get:function(){return N(this).y}},{key:"s",get:function(){return-this.q-this.r}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return new this.constructor(e)}},{key:"equals",value:function(e){return function(e,t){if(x(e)&&x(t))return e.col===t.col&&e.row===t.row;if(Object.hasOwn(e,"col")||Object.hasOwn(t,"col"))throw new Error("Can't compare coordinates where one are offset coordinates. Either pass two offset coordinates or two axial/cube coordinates. Received: ".concat(JSON.stringify(e)," and ").concat(JSON.stringify(t)));var n=k(e)?T(e):e,r=k(t)?T(t):t;return n.q===r.q&&n.r===r.r}(this,x(e)?R(this,e):e)}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.q,",").concat(this.r,")")}},{key:"translate",value:function(e){return function(e,t){var n=E(e),r=n.q,i=n.r,o=n.s,s=E(t),a={q:r+s.q,r:i+s.r,s:o+s.s};return e instanceof C?e.clone(a):a}(this,e)}}],[{key:"settings",get:function(){var e=this.prototype;return{dimensions:e.dimensions,orientation:e.orientation,origin:e.origin,offset:e.offset}}}])}(),j={dimensions:{xRadius:1,yRadius:1},orientation:P.POINTY,origin:{x:0,y:0},offset:-1},q=function(e,t,n,r){return[{x:n+.5*e,y:r-.25*t},{x:n+.5*e,y:r+.25*t},{x:n,y:r+.5*t},{x:n-.5*e,y:r+.25*t},{x:n-.5*e,y:r-.25*t},{x:n,y:r-.5*t}]},A=function(e,t,n,r){return[{x:n+.25*e,y:r-.5*t},{x:n+.5*e,y:r},{x:n+.25*e,y:r+.5*t},{x:n-.25*e,y:r+.5*t},{x:n-.5*e,y:r},{x:n-.25*e,y:r-.5*t}]};function M(e){var t=u(u({},j),e),n=t.dimensions,r=t.orientation,i=t.origin,o=t.offset;return function(e){function t(){return h(this,t),function(e,t,n){return t=a(t),function(e,t){if(t&&("object"==v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,s()?Reflect.construct(t,n||[],a(e).constructor):t.apply(e,n))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,e),d(t,[{key:"dimensions",get:function(){return function(e,t){if(b(e)&&e.xRadius>0&&e.yRadius>0)return e;if(b(e)&&e.width>0&&e.height>0){var n=e.width,r=e.height;return t===P.POINTY?{xRadius:n/Math.sqrt(3),yRadius:r/2}:{xRadius:n/2,yRadius:r/Math.sqrt(3)}}if(e>0)return{xRadius:e,yRadius:e};throw new TypeError("Invalid dimensions: ".concat(JSON.stringify(e),". Dimensions must be expressed as an Ellipse ({ xRadius: number, yRadius: number }), a Rectangle ({ width: number, height: number }) or a number."))}(n,r)}},{key:"orientation",get:function(){return r}},{key:"origin",get:function(){return function(e,t){if(function(e){return b(e)&&w(e.x)&&w(e.y)}(e))return e;if(!t)throw new TypeError("Supply a bounding box ({ width: number, height: number }). Received: ".concat(JSON.stringify(t)));if("topLeft"===e)return{x:-.5*t.width,y:-.5*t.height};throw new TypeError("Invalid origin: ".concat(JSON.stringify(e),". Origin must be expressed as a Point ({ x: number, y: number }) or the string 'topLeft'."))}(i,this)}},{key:"offset",get:function(){return o}}])}(C)}var U=function(e){var t=e.q,n=e.r,r=e.offset;return e.isPointy?function(e,t,n){return{col:e+O(n,t),row:t}}(t,n,r):function(e,t,n){return{col:e,row:t+O(n,e)}}(t,n,r)},N=function(e){var t=e.orientation,n=e.dimensions,r=n.xRadius,i=n.yRadius,o=e.origin,s=o.x,a=o.y,c=e.q,l=e.r;return t===P.POINTY?{x:r*Math.sqrt(3)*(c+l/2)-s,y:3*i/2*l-a}:{x:3*r/2*c-s,y:i*Math.sqrt(3)*(l+c/2)-a}},I=function(e,t,n){var r=e-O(n,t);return{q:r,r:t,s:-r-t}},H=function(e,t,n){var r=e,i=t-O(n,e);return{q:r,r:i,s:-r-i}},R=function(e,t){var n=e.offset,r=e.orientation,i=t.col,o=t.row;return r===P.POINTY?I(i,o,n):H(i,o,n)},D=function(e){var t=E(e),n=t.q,r=t.r,i=t.s,o=Math.round(n),s=Math.round(r),a=Math.round(i),c=Math.abs(n-o),l=Math.abs(r-s),u=Math.abs(i-a);return c>l&&c>u?o=-s-a:l>u?s=-o-a:a=-o-s,{q:o,r:s,s:a}};function L(e,t){return k(t)?T(t):x(t)?R(e,t):E(t)}function W(e,t,n){var r=L(e,t),i=r.q,o=r.r,s=r.s,a=L(e,n),c=a.q,l=a.r,u=a.s;return Math.max(Math.abs(i-c),Math.abs(o-l),Math.abs(s-u))}var F=function(e){return e.CLOCKWISE="CLOCKWISE",e.COUNTERCLOCKWISE="COUNTERCLOCKWISE",e}(F||{}),G=function(e){return e[e.N=0]="N",e[e.NE=1]="NE",e[e.E=2]="E",e[e.SE=3]="SE",e[e.S=4]="S",e[e.SW=5]="SW",e[e.W=6]="W",e[e.NW=7]="NW",e}(G||{}),$=[null,{q:1,r:-1},{q:1,r:0},{q:0,r:1},null,{q:-1,r:1},{q:-1,r:0},{q:0,r:-1}],V=[{q:0,r:-1},{q:1,r:-1},null,{q:1,r:0},{q:0,r:1},{q:-1,r:1},null,{q:-1,r:0}],_=function(e,t){return e.clone(e.isPointy?function(e,t){var n=e.offset,r=e.q,i=e.r,o=e.col,s=e.row;if(t===G.S||t===G.N){var a=t===G.S?s+1:s-1;return I(o,a,n)}var c=$[t];return{q:r+c.q,r:i+c.r}}(e,t):function(e,t){var n=e.offset,r=e.q,i=e.r,o=e.col,s=e.row;if(t===G.E||t===G.W){var a=t===G.E?o+1:o-1;return H(a,s,n)}var c=V[t];return{q:r+c.q,r:i+c.r}}(e,t))};function z(e){return Array.isArray(e)?function(t,n){var r,i=[],s=n,a=o(e);try{for(a.s();!(r=a.n()).done;){var c,l=o((0,r.value)(t,s));try{for(l.s();!(c=l.n()).done;){var u=c.value;i.push(s=u)}}catch(e){l.e(e)}finally{l.f()}}}catch(e){a.e(e)}finally{a.f()}return i}:e}function Y(e){return function(e){return e.direction in G}(e)?function(e){var t=e.start,n=e.direction,r=e.length;return function(e,i){var o=[],s=e(null!=t?t:i);!t&&i&&(s=_(s,n));for(var a=0;a<r;a++)o.push(s),s=_(s,n);return o}}(e):function(e){var t=e.start,n=e.stop;return function(e,r){for(var i=[],o=e(null!=t?t:r),s=function(e,t){return function(n){return{q:e.q*(1-n)+t.q*n,r:e.r*(1-n)+t.r*n}}}(B(o),B(L(o,n))),a=W(o,o,n),c=1/Math.max(a,1),l=!t&&r?1:0;l<=a;l++){var u=D(s(c*l));i.push(e(u))}return i}}(e)}function B(e){return{q:e.q+1e-6,r:e.r+1e-6,s:e.s+-2e-6}}function K(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).includeSource,r=void 0===n||n;return function(n,i){var s,a=[],c=o(z(e)(n,i));try{for(c.s();!(s=c.n()).done;){var l=s.value;r&&a.push(l);var u,h=o(z(t)(n,l));try{for(h.s();!(u=h.n()).done;){var f=u.value;a.push(f)}}catch(e){h.e(e)}finally{h.f()}}}catch(e){c.e(e)}finally{c.f()}return a}}G.E,G.N,G.S,G.W;function J(e){var t=e.center,n=e.rotation,r=void 0===n?F.CLOCKWISE:n;return function(n,i){var o,s,a=r.toUpperCase(),c=[],l=e.radius,u=w(l);u?s=n(t).translate({q:l,s:-l}):l=W(s=n(null!==(o=e.start)&&void 0!==o?o:i),t,s);var h=L(s,t),f=n({q:h.q,r:h.r-l,s:h.s+l});if(a===F.CLOCKWISE)for(var d=0;d<6;d++)for(var m=0;m<l;m++){var y=X[d],p=y.q,g=y.r;f=n({q:f.q+p,r:f.r+g}),c.push(f)}else for(var v=5;v>=0;v--)for(var b=0;b<l;b++){var x=X[v],k=x.q,O=x.r;f=n({q:f.q-k,r:f.r-O}),c.push(f)}var S=!u&&!e.start&&i,T=c.findIndex(function(e){return e.equals(s)});return c.slice(T+(S?1:0)).concat(c.slice(0,T))}}var X=[{q:1,r:0},{q:0,r:1},{q:-1,r:1},{q:-1,r:0},{q:0,r:-1},{q:1,r:-1}];function Q(e){var t=e.radius,n=e.start,r=e.rotation;return function(e,i){var o,s=null!==(o=null!=n?n:i)&&void 0!==o?o:[0,0],a=!n&&i?t:t+1;return K(Y({start:n,direction:G.N,length:a}),J({center:s,rotation:r}))(e,i)}}var Z=new WeakMap,ee=new WeakMap,te=new WeakSet,ne=function(){function s(o){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(h(this,s),function(e,n){t(e,n),n.add(e)}(this,te),e(this,Z,void 0),e(this,ee,new Map),o instanceof s)return n(Z,this,r(Z,o)),void this.setHexes(o);n(Z,this,o),this.setHexes(i(te,this,ie).call(this,a))}return d(s,[{key:"size",get:function(){return r(ee,this).size}},{key:"pixelWidth",get:function(){if(0===this.size)return 0;var e=this.hexPrototype,t=e.isPointy,n=e.width,r=this.toArray(),i=t?r.sort(function(e,t){return t.s-e.s||e.q-t.q}):r.sort(function(e,t){return e.q-t.q}),o=i[0];return i[i.length-1].x-o.x+n}},{key:"pixelHeight",get:function(){if(0===this.size)return 0;var e=this.hexPrototype,t=e.isPointy,n=e.height,r=this.toArray(),i=t?r.sort(function(e,t){return e.r-t.r}):r.sort(function(e,t){return t.s-e.s||e.r-t.r}),o=i[0];return i[i.length-1].y-o.y+n}},{key:Symbol.iterator,value:function(){return r(ee,this).values()}},{key:"hexPrototype",get:function(){return r(Z,this).prototype}},{key:"createHex",value:function(e){return new(r(Z,this))(e)}},{key:"getHex",value:function(e){var t=this.createHex(e);return r(ee,this).get(t.toString())}},{key:"hasHex",value:function(e){return r(ee,this).has(e.toString())}},{key:"setHexes",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var s=t.value,a=s instanceof C?s:new(r(Z,this))(s);i(te,this,re).call(this,a)}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"filter",value:function(e){var t,n=new s(r(Z,this)),a=o(this);try{for(a.s();!(t=a.n()).done;){var c=t.value;e(c)&&i(te,n,re).call(n,c)}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"map",value:function(e){var t,n=new s(r(Z,this)),a=o(this);try{for(a.s();!(t=a.n()).done;){var c=t.value;i(te,n,re).call(n,e(c))}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"traverse",value:function(e){var t,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).bail,a=void 0!==n&&n,c=new s(r(Z,this)),l=o(i(te,this,ie).call(this,e));try{for(l.s();!(t=l.n()).done;){var u=t.value,h=this.getHex(u);if(h)i(te,c,re).call(c,h);else if(a)return c}}catch(e){l.e(e)}finally{l.f()}return c}},{key:"forEach",value:function(e){var t,n=o(this);try{for(n.s();!(t=n.n()).done;)e(t.value)}catch(e){n.e(e)}finally{n.f()}return this}},{key:"reduce",value:function(e,t){if(void 0===t){var n,r,i,s,a=o(this);try{for(a.s();!(s=a.n()).done;){var c=s.value;r=i,i=c,r&&(n=e(r,i))}}catch(e){a.e(e)}finally{a.f()}return n}var l,u=t,h=o(this);try{for(h.s();!(l=h.n()).done;)u=e(u,l.value)}catch(e){h.e(e)}finally{h.f()}return u}},{key:"toArray",value:function(){return Array.from(this)}},{key:"toJSON",value:function(){var e=this.hexPrototype;return{hexSettings:{dimensions:e.dimensions,orientation:e.orientation,origin:e.origin,offset:e.offset},coordinates:this.toArray()}}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.size,")")}},{key:"pointToHex",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).allowOutside,n=void 0===t||t,r=function(e,t){var n=e.dimensions,r=n.xRadius,i=n.yRadius,o=e.origin,s=e.orientation,a=t.x,c=t.y;return a+=o.x,c+=o.y,s===P.POINTY?D({q:Math.sqrt(3)*a/(3*r)-c/(3*i),r:2/3*(c/i)}):D({q:2/3*(a/r),r:Math.sqrt(3)*c/(3*i)-a/(3*r)})}(this.hexPrototype,e),i=this.getHex(r);return n?null!=i?i:this.createHex(r):i}},{key:"distance",value:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside;if(void 0===n||n)return W(this.hexPrototype,e,t);var r=this.getHex(e),i=this.getHex(t);return r&&i?W(this.hexPrototype,r,i):void 0}},{key:"neighborOf",value:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside,r=void 0===n||n,i=_(this.createHex(e),t),o=this.getHex(i);return r?null!=o?o:i:o}}],[{key:"fromIterable",value:function(e){var t=e[Symbol.iterator]().next().value;if(!t)throw new TypeError("Can't create grid from empty iterable: ".concat(JSON.stringify(e)));return new s(t.constructor,e)}},{key:"fromJSON",value:function(e,t){var n=e.hexSettings,r=e.coordinates;if(t){var i=r.map(t);return new s(i.length>0?i[0].constructor:t({q:0,r:0},0,[{q:0,r:0}]).constructor,i)}var o=M(n);return new s(o,r.map(function(e){return new o(e)}))}}])}();function re(e){r(ee,this).set(e.toString(),e)}function ie(e){return i(te,this,oe).call(this,e)?i(te,this,se).call(this,e):Array.isArray(e)&&i(te,this,oe).call(this,e[0])?i(te,this,se).call(this,z(e)):e}function oe(e){return"function"==typeof e}function se(e){return e(this.createHex.bind(this))}const ae=200,ce=-2*Math.max(window.visualViewport.width,window.visualViewport.height);class le extends M({dimensions:100,orientation:P.FLAT,origin:"topLeft"}){f_cost;h_cost;g_cost}const ue=new ne(le,(he={width:15,height:6},function(e,t){var n,r=he.width,i=he.height,o=he.start,s=he.direction,a=void 0===s?G.E:s,c=null!==(n=null!=o?o:t)&&void 0!==n?n:[0,0],l=K(Y({start:c,direction:S(a,2),length:i}),Y({direction:a,length:r-1}))(e,c);return!o&&t?l.slice(1):l}));var he;const fe=(()=>{let e=null;function t(e,t,n){return!(!(e instanceof C)||"string"!=typeof t||""===t||!Object.keys(json.world.improvements).includes(t)||""!==n.key&&n.key!==t||!e.terrain.terrain in json.world.improvements[t]?.terrains||e.city instanceof me)}function n({hex:n}){null===e&&(e=be.scenes.getScene("mainGameScene"));const r={faction:new Map,nation:new Map};let i,o={key:""};const s=new Set;let a;this.food=0,Object.defineProperties(this,{claims:{enumerable:!0,get:()=>(e,t)=>e instanceof ye?(Number.isInteger(t)&&0!==t&&r.faction.set(e,(r.faction.get(e)||0)+t),r.faction.get(e)||0):e instanceof pe?(Number.isInteger(t)&&0!==t&&r.nation.set(e,(r.nation.get(e)||0)+t),r.nation.get(e)||0):r},hex:{get:()=>n},faction:{enumerable:!0,get:()=>{const e={faction:null,claim:0};return r.faction.forEach((t,n)=>{e.claim<t&&(e.faction=n,e.claim=t)}),e.faction}},nation:{enumerable:!0,get:()=>{const e={nation:null,claim:0};return r.nation.forEach((t,n)=>{e.claim<t&&(e.nation=n,e.claim=t)}),e.nation}},improvement:{enumerable:!0,get:()=>i||{}},laborers:{enumerable:!0,get:()=>s,set(e){if(!(e instanceof de))throw new TypeError("Tile.laborers expects to be assigned object instance of Citizen!");return s.add(e),!0}},road:{enumerable:!0,get:()=>a||{},set:t=>"destroy"===t?(a?.image instanceof Phaser.GameObjects.Image&&a.image.destroy(),a=void 0,!0):!!Object.keys(json.world.improvements).includes(t)&&(a={...json.world.roads[t],image:e.add.image(n.x,n.y,`improvements.${t}`).setDepth(6),key:t},!0)},setImprovement:{get:()=>(r,s=null)=>"destroy"===r?(i?.image instanceof Phaser.GameObjects.Image&&i.image.destroy(),i=void 0,o={key:""},!0):!!t(n,r,o)&&(i={...json.world.improvements[r],image:e.add.image(n.x,n.y,`improvements.${r}`).setDepth(5),key:r},s instanceof ye&&(this.claimTerritory(s,10),i.faction=s),o.key=r,!0)},isValidImprovement:{get:()=>e=>t(n,e,o)}})}return Object.assign(n.prototype,{claimTerritory(e,t=0){if(Number.isFinite(t)&&0!==t){let n;e instanceof pe&&this.nation instanceof pe?n=this.nation.index:e instanceof ye&&this.faction instanceof ye&&(n=this.faction.index),this.claims(e,t),e instanceof ye&&this.faction?.index!==n&&(be.markTerritory(this.hex,{graphics:be.graphics.territoryFills,lineOffset:1,fill:!0}),be.markTerritory(this.hex,{graphics:be.graphics.territoryLines,lineOffset:.97,fill:!1}))}}}),n})(),de=(()=>{function e({city:e,hex:t,tile:n}){const r=function(){const e=["Gaius","Lucius","Marcus","Quintus","Titus","Publius","Aulus","Sextus"],t=["Bran","Cai","Elen","Rhiannon","Taran","Mabon","Nia","Owain"],n=["Agricola","Felix","Silvanus","Varus","Florus","Crispus","Severus","Vitalis"],r=["the Smith","of Londinium","the Younger","the Red","from Camulodunum","the Hunter"];return`${Math.random()<.5?e[Math.floor(Math.random()*e.length)]:t[Math.floor(Math.random()*t.length)]} ${n[Math.floor(Math.random()*n.length)]} ${Math.random()<.3?r[Math.floor(Math.random()*r.length)]:""}`.trim()}();e instanceof me&&Object.defineProperty(this,"city",{enumerable:!0,get:()=>e}),(t instanceof C||n?.hex instanceof C)&&Object.defineProperty(this,"hex",{enumerable:!0,get:()=>t||n?.hex}),(n instanceof fe||t?.tile instanceof fe)&&Object.defineProperty(this,"tile",{enumerable:!0,get:()=>n||t?.tile}),Object.defineProperties(this,{name:{enumerable:!0,get:()=>r},sprite:{enumerable:!0,get:()=>"laborers.farmer"}})}return Object.assign(e.prototype,{FOOD_CONSUMPTION:2,assignTile(e){if(!(e instanceof fe))throw new TypeError("Citizen.assignTile expects to be passed object instance of Tile!");this.tile=e}}),e})(),me=(()=>{let e=null;function t({col:t,row:n,level:r=1,nation:i}={}){if(null===e&&(e=be.scenes.getScene("mainGameScene")),!(i instanceof pe))throw new TypeError("City expects to be assigned a Nation!");const o=ue.getHex({row:n,col:t});o.tile.setImprovement("destroy");const s=e.add.image(o.x,o.y,"cities",i.frame).setDepth(10).setScale(.8);o.city=this;const a=new Set;ue.traverse(Q({start:[o.q,o.r],radius:1})).forEach(e=>{e.tile.claimTerritory(i,100)}),ue.traverse(J({center:[o.q,o.r],radius:2})).forEach(e=>{e.terrain.isWater&&e.tile.claimTerritory(i,50)}),this.housing=(()=>{switch(r){case 1:return 3;case 2:return 6}return 0})(),Object.defineProperties(this,{hex:{enumerable:!0,get:()=>o},laborers:{enumerable:!0,get:()=>a,set(e){if(!(e instanceof de))throw new TypeError("City.laborers expects to be assigned object instance of Citizen!");return a.add(e),!0}},nation:{enumerable:!0,get:()=>i},sprite:{get:()=>s},level:{enumerable:!0,get:()=>r},housing:{enumerable:!0,get:()=>this.housing}})}return Object.assign(t.prototype,{}),t})(),ye=(()=>{let e=null;function t({index:t}){const n=(()=>{switch(t%3){case 0:return 3329330;case 1:return 16711680;case 2:return 255;default:return 11184810}})(),r=json.world?.FactionNames[t];let i=0,o=[];Object.defineProperties(this,{color:{enumerable:!0,get:()=>n},index:{enumerable:!0,get:()=>t},money:{enumerable:!0,get:()=>i,set(e){if(!Number.isFinite(e)||e<0)throw new TypeError("Faction.money expects to be assigned a positive number!");i=e}},name:{enumerable:!0,get:()=>r},nation:{enumerable:!0,get:()=>be.nations[0]},units:{enumerable:!0,get:()=>o,set:e=>{if(!Array.isArray(e))throw new TypeError("Faction.units expects to be assigned an Array!");o=e.filter(e=>e instanceof Ce&&!1===e.deleted)}},activeUnit:{enumerable:!0,get(){if(Number.isInteger(e)&&e>=0&&e<=o.length)return o[e]},set:t=>Number.isInteger(t)&&t>=0?t>=o.length?(e=t%o.length,!0):(e=t,!0):(null===t&&(e=null),!1)}})}return Object.assign(t.prototype,{addUnit(e,t,n,r){this.units.push(new Ce(e,{row:t,col:n,scene:r,faction:this}))},checkEndTurn(){this.activateNext()||be.endTurn()},activateUnit(t=e){if(0===this.units.length)return this.checkEndTurn(),!1;const n=this.units[t];return n instanceof Ce&&!0!==n.deleted&&(n.activate(),e=t,!0)},activateNext(){for(let t=e+1;t<this.units.length;t++)if(this.units[t]instanceof Ce&&this.units[t].moves>0&&this.activateUnit(t))return!0;for(let t=0;t<=e;t++)if(this.units[t]instanceof Ce&&this.units[t].moves>0&&this.activateUnit(t))return!0;return!1}}),t})(),pe=(()=>{function e({index:e}){const t=(()=>{switch(e%3){case 0:return 3329330;case 1:return 16711680;case 2:return 255;default:return 11184810}})(),n=json.world?.NationNames[e];Object.defineProperties(this,{color:{enumerable:!0,get:()=>t},frame:{enumerable:!0,get:()=>(e+1)%3},index:{enumerable:!0,get:()=>e},name:{enumerable:!0,get:()=>n}})}return Object.assign(e.prototype,{}),e})(),ge=(()=>{function e({num:e=1,type:t,hex:n}={}){if(!(n instanceof C))throw new TypeError("Goods expects to be assigned a Honeycomb.Hex!");let r=0;const{spriteRef:i}=(()=>{if("food"===t)return{spriteRef:"goods.wheat"};throw new TypeError(`Unknown Goods type '${t}'`)})(),o=n.tile.faction,s=be.scenes.getScene("mainGameScene").add.sprite(n.x,n.y,i).setDepth(20),a=n;Object.defineProperties(this,{faction:{enumerable:!0,get:()=>o},hex:{enumerable:!0,get:()=>n,set(e){if(!(e instanceof C))throw new TypeError("Goods.hex expects to be assigned a Honeycomb.Hex!");n=e}},num:{enumerable:!0,get:()=>e},rounds:{enumerable:!0,get:()=>r,set(e){if(!Number.isFinite(e)||e<0)throw new TypeError("Goods.rounds expects to be assigned a positive number!");r=e}},sprite:{enumerable:!0,get:()=>s},start:{enumerable:!0,get:()=>a},type:{enumerable:!0,get:()=>t}})}return Object.assign(e.prototype,{}),e})();let ve=[];const we={ease:"Linear",duration:1e3,yoyo:!1},be={players:[],turn:0,activeUnit:null,currentPlayer:null,intCurrentPlayer:null,sprActiveUnit:null,graphics:{},uiDisplays:{},startRound(){this.players.forEach(e=>{e.units=e.units}),be.scenes.getScene("mainGameScene"),ue.forEach(e=>{if(this.nations.forEach(t=>{e.tile.nation===t?e.tile.claimTerritory(t,1):e.tile.claims(t)>0&&e.tile.claimTerritory(t,-1)}),this.players.forEach(t=>{e.tile.faction===t?e.tile.claimTerritory(t,1):e.tile.claims(t)>0&&e.tile.claimTerritory(t,-1)}),e.tile.food=0,e.tile.laborers.size>0){let t=0;t+=e.terrain.food||0,t+=e.tile.improvement.food||0,t>0&&ve.push(new ge({type:"food",num:t,hex:e}))}}),ue.forEach(e=>{e.city instanceof me&&(e.city,ue.traverse(Q({start:[e.q,e.r],radius:2})).forEach(e=>{}))}),this.turn++,be.uiDisplays.round.setText(`Round ${this.turn}`),this.startTurn(0)},startTurn(e){if(!Number.isFinite(e))throw new TypeError(`Unknown player ${e}`);if(this.currentPlayer=this.players[e],!(this.currentPlayer instanceof ye))throw new TypeError(`Player ${e} is not a Faction Object`);be.uiDisplays.faction.setText(`${this.currentPlayer.name}'s Turn`).setX(14+be.uiDisplays.round.displayWidth+10).setColor(0===e?"goldenrod":"lightgrey"),this.intCurrentPlayer=e,this.currentPlayer.units.forEach(e=>{e.moves=e.base.movementPoints}),this.currentPlayer.activateUnit(0)},markTerritory(e=null,{graphics:t=this.graphics.territoryLines,lineOffset:n=.97,offsetX:r=0,offsetY:i=0,fill:o=!1,lineWidth:s=5}={}){(e instanceof C?[e]:ue).forEach(e=>{if(!(e.tile instanceof fe&&e.tile.faction instanceof ye))return;!1===o?t.lineStyle(s,e.tile.faction.color):t.fillStyle(e.tile.faction.color),t.beginPath();const[a,...c]=e.corners.map(t=>xe(t,e,n));t.moveTo(a.x+r,a.y+i),c.forEach(({x:e,y:n})=>{t.lineTo(e+r,n+i)}),t.closePath()[!1===o?"strokePath":"fillPath"]()})},endTurn(){console.log("Sam, endTurn!"),this.intCurrentPlayer++,this.intCurrentPlayer>=this.players.length?this.endRound():this.startTurn(this.intCurrentPlayer)},endRound(){console.log("Sam, endRound!");const e=be.scenes.getScene("mainGameScene"),t=[];be.uiDisplays.faction.setX(14+be.uiDisplays.round.displayWidth+10).setText("End of Round").setColor("lightgrey");const n=[];ue.forEach(e=>{e.city instanceof me&&n.push(e)}),ve=ve.filter(({num:e,sprite:t})=>e>0&&t instanceof Phaser.GameObjects.Sprite&&t.active),ve.forEach((r,i)=>{let{faction:o,hex:s,num:a,sprite:c,type:l}=r;if("food"!==l)return;if(a<=0)return c.setActive(!1),void c.destroy();if(s.tile.laborers.size>0&&s.tile.food<s.tile.laborers.size*de.FOOD_CONSUMPTION){const e=Math.max(0,s.tile.laborers.size*de.FOOD_CONSUMPTION-s.tile.food),t=Math.min(e,a);if(r.num=a-=t,s.tile.food+=t,a<=0)return c.setActive(!1),void c.destroy()}let u=null,h=1/0;if(n.forEach(e=>{const t=ue.distance(s,e);t<h&&(u=e,h=t)}),u instanceof C&&u.city instanceof me){const n=Te(s,u);if(Array.isArray(n)&&n.length>0){const i=n.shift();i.city instanceof me?t.push(new Promise(t=>{e.tweens.add({targets:c,x:i.x,y:i.y,...we,onComplete(e){o.money+=10*a,be.uiDisplays.money.setText(be.players[0].money.toLocaleString("en-Us")),c.setActive(!1),c.destroy(),e.destroy(),t()}})})):(r.hex=i,t.push(new Promise(t=>{e.tweens.add({targets:c,x:i.x,y:i.y,...we,onComplete(e){e.destroy(),t()}})})))}}"food"===l&&++r.rounds>5&&(c.setActive(!1),c.destroy())}),ue.forEach(e=>{e.tile.laborers.size>0&&(e.tile.food,e.tile.laborers.size,de.FOOD_CONSUMPTION),e.tile.food-=e.tile.laborers.size*de.FOOD_CONSUMPTION}),Promise.all(t).then(()=>{be.uiDisplays.money.setText(be.players[0].money.toLocaleString("en-Us")),this.startRound()})},closeUnitActionMenu(){this.domContainer.innerHTML=""}};function xe(e,t,n=.9){const r=(e.y-t.y)/(e.x-t.x),i=e.y-r*e.x,o=(e.x-t.x)*n+t.x;return{x:o,y:r*o+i}}function ke(e,t,n){switch(e){case"u":n%2==0&&t--,n--;break;case"i":t--;break;case"o":n%2==0&&t--,n++;break;case"j":n%2==1&&t++,n--;break;case"k":t++;break;case"l":n%2==1&&t++,n++}return[t,n]}function Oe(){for(be.sprActiveUnit.setActive(!1).setPosition(ce,ce).setDepth(0),Pe.graphics?.destroy();Pe.text.length>0;)Pe.text.pop().destroy()}let Se=null;function Te(e,t,n=Se){let r=[],i=[],o=!1;for(e.parent=void 0,r.push(e),e.g_cost=0;r.length>0;){const e=r.sort((e,t)=>e.f_cost-t.f_cost||e.h_cost-t.h_cost)[0];if(e===t){o=!0;break}r=r.filter(t=>e!==t),i.push(e),ue.traverse(J({center:[e.q,e.r],radius:1})).forEach(o=>{i.includes(o)||Me(o.row,o.col,n)&&(o.g_cost=e.g_cost+Ee(n,o,e),o.h_cost=ue.distance(e,t),o.f_cost=o.g_cost+o.h_cost,r.includes(o)||(o.parent=e,r.push(o)))})}if(!o)return;const s=[t];let a=t;do{a=a.parent,a!==e&&s.unshift(a)}while(a?.parent instanceof C);return s}function Ee(e,t,n=e.hex){return t instanceof C&&(e===Se||e instanceof Ce)?t.terrain.isWater&&!e.base.moveOnWater?e.base.movementCosts[t.terrain.terrain]??1/0:e.base.movementCosts[t.terrain.terrain]??t.terrain.movementCost??1/0:1/0}const Pe={text:[]},Ce=(()=>{let e=null;function t(t,{row:n,col:r,faction:i}){const o=json.world.units[t];if("object"!=typeof o||null===o)throw new TypeError(`Unknown unit '${t}'`);null===e&&(e=be.scenes.getScene("mainGameScene"));const{x:s,y:a}=ue.getHex({row:n,col:r}),c=e.add.sprite(s,a,`unit.${t}`).setTint(3684408).setDepth(11);c.setScale(80/c.width),this.col=r,this.row=n,this.path=[],this.deleted=!1,Object.defineProperties(this,{base:{enumerable:!0,get:()=>o},hex:{enumerable:!0,get:()=>ue.getHex({row:this.row,col:this.col})},faction:{enumerable:!0,get:()=>i},scene:{enumerable:!0,get:()=>e},sprite:{enumerable:!0,get:()=>c},unitType:{enumerable:!0,get:()=>t}})}return Object.assign(t.prototype,{activate(){Oe();const t=ue.getHex({row:this.row,col:this.col});be.sprActiveUnit.setActive(!0).setPosition(t.x,t.y).setDepth(99);const n=xe(this.scene.cameras.main.getScroll(t.x,t.y),{x:this.scene.cameras.main.scrollX,y:this.scene.cameras.main.scrollY},.2);if(setTimeout(()=>{this.scene.cameras.main.setScroll(n.x,n.y),setTimeout(()=>{this.scene.cameras.main.getScroll(t.x,t.y),this.scene.cameras.main.pan(t.x,t.y,500,"Linear",!0)},0)},0),this.sprite.setTint(16777215).setDepth(100),Array.isArray(this.path)&&this.path.length>0){for(;this.moves>=Ee(this,this.path[0]);)this.doAction("moveTo",this.path.shift());this.deactivate(!0)}else 0===this.faction.index?(["L","K","J","U","I","O"].forEach(t=>{const[n,r]=ke(t.toLowerCase(),this.row,this.col);if(Me(n,r,this)){const i=ue.getHex({row:n,col:r}),o=e.add.text(i.x-100,i.y+ae/6,t,{fixedWidth:ae,font:"25pt Trebuchet MS",align:"center",color:"khaki",stroke:"black",strokeThickness:7}).setOrigin(0).setDepth(98);Pe.text.push(o),this.scene.cameras.getCamera("mini").ignore(o)}}),be.activeUnit=this,this.scene.input.keyboard.enabled=!0):this.deactivate(!0)},deactivate(e=!1){!0===e&&(this.moves=0),Oe(),this.sprite.setTint(3684408).setDepth(11),be.activeUnit=null,this.scene.input.keyboard.enabled=!1,be.currentPlayer.checkEndTurn()},destroy(){this.deactivate(!0),this.sprite.setActive(!1),this.sprite.destroy(),this.deleted=!0},doAction(e,t=null){if(be.closeUnitActionMenu(),"w"!==e&&"Tab"!==e){if("s"!==e){if("moveTo"===e&&t instanceof C){if(1===ue.distance(this.hex,t))this.moveTo(t);else{const e=Te(this.hex,t,this);if(!Array.isArray(e)||0===e.length)return void console.warn("Sam, no path found!");Array.isArray(e)&&(this.path=e)}}else if(["u","i","o","j","k","l"].includes(e)){const[t,n]=ke(e,this.row,this.col);this.moveTo(ue.getHex({row:t,col:n}))}else if("c"===e){const e=ue.getHex({row:this.row,col:this.col});if(!qe.c.isValidOption({hex:e,faction:this.faction}))return void console.warn("Sam, you own this already");e.tile.claimTerritory(this.faction,10),this.deactivate(!0)}else{const t=ue.getHex({row:this.row,col:this.col});switch(this.unitType){case"settler":break;case"homesteader":if("f"===e)return void(t.tile.setImprovement("farm",this.faction)?(t.tile.laborers=new de({hex:t}),this.destroy()):console.warn("Could not build farm here"));break;case"builder":if("C"===e){if(!qe.C.isValidOption({hex:t}))return;if("farm"===t.tile.improvement.key)return t.tile.setImprovement("destroy"),void this.deactivate(!0)}}}this.moves>0?this.faction.activateUnit():this.deactivate()}else this.deactivate(!0);}else this.deactivate()},moveTo(t){t instanceof C&&Me(t.row,t.col,this)&&(this.row=t.row,this.col=t.col,e.tweens.add({targets:this.sprite,x:t.x,y:t.y,ease:"Quad.inOut",duration:800,yoyo:!1,onComplete(e){e.destroy()}}),this.moves-=Ee(this,t),this.moves<=0&&this.deactivate())}}),t})();function je(e){Object.keys(e).forEach(t=>{"function"==typeof e[t]&&Object.defineProperty(this,t,{enumerable:!0,get:()=>e[t]})}),"function"!=typeof e.text&&Object.defineProperty(this,"text",{enumerable:!0,get:()=>"string"==typeof e.text?()=>e.text:()=>"[action text missing]"})}Object.assign(je.prototype,{});const qe=[{key:"moveTo",text:({hex:e})=>e instanceof C?`Move to ${e.row}×${e.col}`:"Move here",isValidOption:({hex:e,unit:t})=>Me(e.row,e.col,t)},{key:"tile",text:"Information on space",isValidOption:({hex:e})=>e instanceof C&&e.tile instanceof fe,doAction({hex:e}){this.isValidOption({hex:e})&&(be.closeUnitActionMenu(),be.scenes.start("tile-view",{hex:e}))}},{key:"city",text:"View city",isValidOption:({hex:e})=>e.tile?.faction===be.currentPlayer&&e.city instanceof me,doAction({hex:e}){this.isValidOption({hex:e})&&(be.closeUnitActionMenu(),be.scenes.start("city-view",{hex:e}))}},{key:"activateUnit",text:({unit:e})=>{if(e instanceof Ce){const t=e.moves>0?`(${e.moves} moves left)`:"(no moves)";return`Activate ${e.unitType} ${t}`}return"Activate unit"},isValidOption:({unit:e})=>e instanceof Ce&&!e.deleted,doAction({unit:e,faction:t}){if(this.isValidOption({unit:e})){be.closeUnitActionMenu(),be.activeUnit instanceof Ce&&be.activeUnit.deactivate(!1);const t=e.faction.units.indexOf(e);t>=0&&e.faction.activateUnit(t)}}},{key:"b",text:"<u>B</u>uild city",isValidOption:({hex:e})=>!(e.terrain.isWater||ue.traverse(Q({start:[e.q,e.r],radius:1})).filter(e=>e.city instanceof me).size>0)},{key:"c",text:"<u>C</u>laim territory",isValidOption:({hex:e,faction:t})=>e.tile.faction!==t},{key:"C",text:"Clear land <kbd>Shift+C</kbd>",isValidOption:({hex:e})=>["farm"].includes(e.tile.improvement.key)},{key:"f",text:"Build <u>f</u>arm",isValidOption:({hex:e})=>e.tile.isValidImprovement("farm")},{key:"w",text:"<u>W</u>ait"},{key:"s",text:"<u>S</u>tay here this turn"},{key:"",text:"Cancel"}].reduce((e,t)=>({...e,[t.key]:new je(t)}),{});function Ae(e,t=null){return be.currentPlayer!==be.players[0]?(console.warn("Not your turn!"),!1):("object"!=typeof e||!e.repeat)&&("string"==typeof e&&qe[e]instanceof je&&"function"==typeof qe[e].doAction?(qe[e].doAction({hex:t}),!0):be.activeUnit instanceof Ce&&void be.activeUnit.doAction(e.key??e,t))}function Me(e,t,n=Se){const r=ue.getHex({row:e,col:t});if(!(r instanceof C))return!1;if(n instanceof Ce&&r.city instanceof me&&r.city.nation!==n.faction.nation&&(!n.attack||!n.attackCities))return!1;const i=Ee(n,r);return!!Number.isFinite(i)&&i<=n.moves}function Ue(e){if(!(e instanceof C&&e.tile instanceof fe))return;const t=[],n=function(e){if(!(e instanceof C))return[];const t=[];return be.players.forEach(n=>{n.units.forEach(n=>{n.hex.row!==e.row||n.hex.col!==e.col||n.deleted||t.push(n)})}),t}(e);if(n.length>0&&n.forEach(e=>{e!==be.activeUnit&&(e.faction!==be.currentPlayer&&be.activeUnit||t.push({action:"activateUnit",unit:e}))}),be.activeUnit instanceof Ce)if(console.log("Sam, unit, current location:",be.activeUnit.hex.row,be.activeUnit.hex.col),be.activeUnit.hex.row==e.row&&be.activeUnit.hex.col==e.col){switch(be.activeUnit.unitType){case"settler":qe.b.isValidOption({hex:e})&&t.push("b");break;case"homesteader":["f"].forEach(n=>{qe[n].isValidOption({hex:e})&&t.push(n)})}qe.c.isValidOption({hex:e,faction:be.activeUnit.faction})&&t.push("c")}else Me(e.row,e.col,be.activeUnit)&&t.push("moveTo");if(qe.city.isValidOption({hex:e})&&t.push("city"),be.activeUnit.hex.row===e.row&&be.activeUnit.hex.col===e.col&&t.push("w","s"),t.push("tile"),0===t.length)return void be.closeUnitActionMenu();if(1===t.length&&"object"==typeof t[0])switch(t[0].action){case"moveTo":if(1===ue.distance(be.activeUnit.hex,e))return void be.activeUnit.doAction("moveTo",e);break;case"city":return void Ae("city",e);case"tile":return void Ae("tile",e)}be.domContainer.innerHTML="";const r=document.createElement("div");r.classList.add("menu"),t.concat([""]).forEach(t=>{const n=document.createElement("button");if(t?.action){const e=qe[t.action];n.innerHTML=e.text(t),n.addEventListener("click",()=>{e.doAction(t)})}else{const r=t;n.innerHTML=qe[r].text({hex:e}),n.addEventListener("click",()=>{Ae(r,e)})}n.style.pointerEvents="auto",r.appendChild(n)}),r.style.pointerEvents="auto",be.domContainer.appendChild(r),be.domContainer.style.zIndex=1}const Ne=.5,Ie={type:Phaser.AUTO,height:window.visualViewport.height/Ne,width:window.visualViewport.width/Ne,zoom:Ne,backgroundColor:"#71ABFF",scene:{key:"mainGameScene",preload(){Object.entries(json.world.terrains).forEach(([e,t])=>{this.load.image(`tile.${e}`,`img/tiles/${t.tile}.png`)}),this.load.spritesheet("cities","img/tiles/cities.png",{frameHeight:200,frameWidth:200}),Se={...json.world.ResourceTransporter},Object.entries(json.world.improvements).forEach(([e,t])=>{"string"==typeof t.tile&&t.tile.length>0&&this.load.image(`improvements.${e}`,`img/improvements/${t.tile}.png`)}),Object.entries(json.world.goods).forEach(([e,t])=>{"string"==typeof t.tile&&t.tile.length>0&&this.load.image(`goods.${e}`,`img/resources/${t.tile}.png`)}),this.load.image("laborers.farmer","img/laborers/farmer.png"),this.load.image("activeUnit","img/activeUnit.png"),Object.keys(json.world.units).forEach(e=>{this.load.image(`unit.${e}`,`img/units/${e}.png`)})},create(){be.graphics={...be.graphics,territoryFills:this.add.graphics({x:0,y:0}).setDepth(2),territoryLines:this.add.graphics({x:0,y:0}).setDepth(2)},ue.forEach(e=>{const t=json.world.world[e.row][e.col];Object.assign(e,t,{tile:new fe({hex:e}),terrain:{...json.world.terrains[t.terrain],terrain:t.terrain},sprite:this.add.image(e.x,e.y,`tile.${t.terrain}`).setDepth(1).setInteractive(new Phaser.Geom.Polygon(ue.getHex({row:0,col:0}).corners),Phaser.Geom.Polygon.Contains),text:this.add.text(e.x-100,e.y+ae/3.6,e.row+"\xD7"+e.col,{fixedWidth:ae,font:"12pt Trebuchet MS",align:"center",color:"white"}).setOrigin(0)})}).forEach(e=>{"object"==typeof e.city&&null!==e.city&&(e.city=new me({...e.city,col:e.col,row:e.row,nation:be.nations[e.city.nation]})),"string"==typeof e.improvement&&e.tile.setImprovement(e.improvement)}),be.sprActiveUnit=this.add.image(ce,ce,"activeUnit").setActive(!1);{const e=ue.pixelWidth,t=ue.pixelHeight,n=window.visualViewport.width/Ne/2,r=window.visualViewport.height/Ne/2;this.cameras.main.setBounds(-n,-r,e+2*n,t+2*r),this.cameras.main.ignore([be.graphics.territoryFills]);const i=this.cameras.add(window.visualViewport.width/Ne-800,window.visualViewport.height/Ne-400,800,400);i.setZoom(.2).setName("mini").setBackgroundColor(0),i.centerOn(ue.pixelWidth/2,ue.pixelHeight/2),i.ignore([be.graphics.territoryLines])}let e=!1;const t={x:0,y:0},n={x:0,y:0};let r=4;this.input.on("pointerdown",i=>{switch(t.x=i.x,t.y=i.y,n.x=this.cameras.main.scrollX,n.y=this.cameras.main.scrollY,e=!1,i.pointerType){case"touch":r=10;break;case"pen":r=8;break;default:r=4}}),this.input.on("pointermove",i=>{if(!i.isDown)return;const o=i.x-t.x,s=i.y-t.y;if(!e&&(Math.abs(o)>r||Math.abs(s)>r)&&(e=!0),e){const e=this.cameras.main.zoom||1;this.cameras.main.setScroll(n.x-o/e,n.y-s/e)}}),this.input.on("pointerup",t=>{e||Ue(ue.pointToHex({x:t.worldX,y:t.worldY})),e=!1}),be.players[0].addUnit("rancher",2,3,this),be.players[0].addUnit("homesteader",2,4,this),be.players[0].addUnit("miner",2,2,this),be.players[0].addUnit("settler",3,3,this),be.players[0].addUnit("builder",1,3,this),this.input.keyboard.on("keydown",e=>{if(!(e.ctrlKey&&["r","R","1","2","3","4","5","6","7","8","9"].includes(e.key)||e.ctrlKey&&"I"===e.key)){switch(e.preventDefault(),e.key){case"ArrowUp":return void(this.cameras.main.scrollY-=25);case"ArrowDown":return void(this.cameras.main.scrollY+=25);case"ArrowLeft":return void(this.cameras.main.scrollX-=25);case"ArrowRight":return void(this.cameras.main.scrollX+=25);case"ContextMenu":case" ":return void(be.activeUnit instanceof Ce&&Ue(be.activeUnit.hex))}Ae(e)}}).enabled=!1,this.events.on("pause",()=>{console.log("Sam, mainGameScene paused"),be.scenes.sleep("mainControls"),Oe()}),this.events.on("resume",()=>{console.log("Sam, mainGameScene resumed"),be.scenes.wake("mainControls"),be.currentPlayer.activateUnit()}).on("wake",()=>{console.log("Sam, mainGameScene woken"),be.scenes.wake("mainControls"),be.currentPlayer.activateUnit()}),this.events.once("create",He)},update(){}}};function He(){be.scenes.isActive("mainGameScene")&&be.scenes.isActive("mainControls")&&be.startRound()}function Re({htmlElementId:e,imageKey:t,scene:n=be.scenes.getScene("mainGameScene")}={}){const r=document.getElementById(e),i=n.textures.get(t);i instanceof Phaser.Textures.Texture&&r instanceof Element&&r.append(i.getSourceImage())}yodasws.page("pageGame").setRoute({template:"pages/game/game.html",canonicalRoute:"/game/",route:"/game/?"}).on("load",()=>{be.nations=[new pe({index:0})],be.players=[new ye({index:0}),new ye({index:1}),new ye({index:2})];const e=new Phaser.Game({...Ie,parent:document.querySelector("main"),dom:{createContainer:!0}});e.scene.add("mainControls",{preload(){this.load.image("coins","img/resources/coins.png")},create(){const e=be.graphics.mainControls=this.add.graphics({x:0,y:0});let t=15;be.uiDisplays.round=this.add.text(14,t,`Round ${be.turn}`,{fontFamily:"Trebuchet MS",fontSize:"28px",color:"white",stroke:"black",strokeThickness:5,maxLines:1}),be.uiDisplays.faction=this.add.text(14+be.uiDisplays.round.displayWidth+10,t+2,"",{fontFamily:"Trebuchet MS",fontSize:"26px",color:"white",stroke:"black",strokeThickness:5,maxLines:1}),t+=be.uiDisplays.faction.displayHeight+5;{t-=15;const e=this.add.image(0,t,"coins").setDepth(2);e.setScale(32/e.width),e.x=20+e.displayWidth/2,e.y=t+=20+e.displayHeight/2,be.uiDisplays.money=this.add.text(e.x+e.displayWidth/2+6,e.y-e.displayHeight/2-4,be.players[0].money.toLocaleString("en-Us"),{fontFamily:"Trebuchet MS",fontSize:"28px",color:"gold",stroke:"black",strokeThickness:5,maxLines:1}).setLetterSpacing(1),t+=be.uiDisplays.money.displayHeight}e.fillStyle(0,.5),e.fillRect(0,0,Ie.width,t),this.input.keyboard.on("keydown",e=>{if(!(e.ctrlKey&&["r","R","1","2","3","4","5","6","7","8","9"].includes(e.key)||e.ctrlKey&&"I"===e.key))switch(e.preventDefault(),e.key){case"F1":case"F3":case"F4":case"F5":break;case"F2":be.graphics.gfxClaims.destroy()}}),this.events.once("create",He)},update(){}},!0),e.scene.moveAbove("mainGameScene","mainControls"),e.scene.add("city-view",{preload(){},create(t){if(!(t.hex instanceof C&&t.hex.tile instanceof fe))return void e.scene.resume("mainGameScene");console.log("Sam, city-view created"),e.scene.pause("mainGameScene");{const e=this.add.graphics({x:0,y:0}).setDepth(0);e.fillStyle(0,.5),e.fillRect(0,0,Ie.width,Ie.height)}const n=this.add.graphics({x:0,y:0}).setDepth(1);n.fillStyle(0,1),n.fillRect(Ie.width-100,0,100,100),this.add.text(Ie.width-100,0,"\xD7 ",{fixedWidth:100,fixedHeight:100,font:"60pt Trebuchet MS",align:"right",color:"white",stroke:"black",strokeThickness:7}).setDepth(2).setInteractive().on("pointerdown",()=>{e.scene.stop("city-view")});const[r,i]=[t.hex.x,t.hex.y],o=Math.min(Ie.height,Ie.width)/7/ae,s=Ie.width/2,a=Ie.height/3;ue.traverse(Q({start:[t.hex.q,t.hex.r],radius:2})).forEach(e=>{const t={x:(e.x-r)*o+s,y:(e.y-i)*o+a},c=this.add.image(t.x,t.y,`tile.${e.terrain.terrain}`).setDepth(1);if(c.scaleX=o,c.scaleY=o,be.markTerritory(e,{offsetX:0-e.x+s+(e.x-r)*o,offsetY:0-e.y+a+(e.y-i)*o,graphics:n.setDepth(2),lineOffset:.95*o}),e.tile.laborers.size>0){const n=ae*o;this.add.text(t.x-n/2,t.y+n/4,`Food: ${(e.terrain.food||0)+(e.tile.improvement.food||0)}`,{font:"14pt Trebuchet MS",align:"center",color:"white",stroke:"black",strokeThickness:7,fixedWidth:n}).setDepth(3)}}),this.input.keyboard.enabled=!0,this.input.keyboard.on("keydown",t=>{"Escape"===t.key&&e.scene.stop("city-view")}),this.events.on("sleep",()=>{console.log("Sam, city-view sleep"),e.domContainer.innerHTML="",e.scene.wake("mainGameScene")}).on("shutdown",()=>{console.log("Sam, city-view shutdown"),e.domContainer.innerHTML="",e.scene.wake("mainGameScene")})},update(){}}),e.scene.add("tile-view",{preload(){},create({hex:t}){if(!(t instanceof C&&t.tile instanceof fe))return void e.scene.resume("mainGameScene");console.log("Sam, tile-view created"),e.scene.pause("mainGameScene");const n=document.getElementById("tile-view");Re({imageKey:`tile.${t.terrain.terrain}`,htmlElementId:"terrain",scene:this});const r=document.getElementById("terrain");if(r instanceof Element){const e=document.createElement("div");e.classList.add("name"),e.innerHTML=t.terrain.name,r.appendChild(e)}if(console.log("Sam, terrain:",t.terrain),t.tile.improvement?.image instanceof Phaser.GameObjects.Image){Re({imageKey:`improvements.${t.tile.improvement.key}`,htmlElementId:"improvements",scene:this});const e=document.getElementById("improvements");if(e instanceof Element){const n=document.createElement("div");n.classList.add("name"),n.innerHTML=t.tile.improvement.title,e.appendChild(n)}console.log("Sam, improvement:",t.tile.improvement)}n.removeAttribute("hidden"),this.input.keyboard.enabled=!0,this.input.keyboard.on("keydown",t=>{"Escape"===t.key&&e.scene.stop("tile-view")}),this.events.on("sleep",()=>{n.setAttribute("hidden",!0),n.querySelectorAll("div").forEach(e=>e.innerHTML=""),console.log("Sam, tile-view sleep"),e.domContainer.innerHTML="",e.scene.wake("mainGameScene")}).on("shutdown",()=>{n.setAttribute("hidden",!0),n.querySelectorAll("div").forEach(e=>e.innerHTML=""),console.log("Sam, tile-view shutdown"),e.domContainer.innerHTML="",e.scene.wake("mainGameScene")})},update(){}}),setTimeout(()=>{},1e3),e.scene.add("main-menu",{preload(){},create(){},update(){}}),e.scene.add("tech-tree",{preload(){},create(){},update(){}}),Object.assign(be,{scenes:e.scene,domContainer:e.domContainer}),e.domContainer.classList.add("game")})},692:e=>{"use strict";e.exports=JSON.parse("{\"improvements\":{\"farm\":{\"title\":\"subsistence farm\",\"tile\":\"farm\",\"housing\":1,\"terrains\":{\"grass\":{\"food\":2,\"turns\":1},\"moor\":{\"food\":1,\"turns\":1},\"swamp\":{\"food\":2,\"turns\":6}}}},\"FactionNames\":[\"Publius Helvius Pertinax\",\"Gaius Flavius Agricola\",\"Brigantes\",\"Catuvellauni\",\"Trinovantes\",\"Dobunni\",\"Cornovii\",\"Atrebates\"],\"NationNames\":[\"Roman Empire\"],\"ResourceTransporter\":{\"moves\":12,\"base\":{\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}}},\"goods\":{\"wheat\":{\"tile\":\"wheat\"}},\"terrains\":{\"desert\":{\"name\":\"Desert\",\"movementCost\":12,\"food\":0,\"tile\":\"desert\"},\"grass\":{\"name\":\"Grassland\",\"movementCost\":12,\"food\":1,\"tile\":\"grass\"},\"hill\":{\"name\":\"Hill\",\"movementCost\":12,\"food\":1,\"tile\":\"grass\"},\"lake\":{\"name\":\"Lake\",\"movementCost\":12,\"food\":1,\"isWater\":true,\"tile\":\"lake\"},\"marsh\":{\"name\":\"Marsh\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"swamp\"},\"moor\":{\"name\":\"Moor\",\"movementCost\":12,\"food\":0,\"tile\":\"mountains\"},\"mountain\":{\"name\":\"Mountain\",\"movementCost\":12,\"food\":0,\"tile\":\"mountains\"},\"ocean\":{\"name\":\"Ocean\",\"movementCost\":12,\"food\":1,\"isWater\":true,\"tile\":\"ocean\"},\"swamp\":{\"name\":\"Swamp\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"swamp\"}},\"units\":{\"builder\":{\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"homesteader\":{\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"miner\":{\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"rancher\":{\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"settler\":{\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"warrior\":{\"attack\":1,\"attackCities\":true,\"defense\":1,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}}},\"world\":[[{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"swamp\",\"river\":true},{\"terrain\":\"lake\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"lake\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"desert\"},{\"terrain\":\"desert\",\"river\":true},{\"terrain\":\"desert\"},{\"terrain\":\"grass\",\"city\":{\"nation\":0}},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}]]}")},907:()=>{yodasws.page("pageBlog").setRoute({title:"Blog",canonicalRoute:"/blog/",template(e,...t){const n=t.join("/").replace(/\/+/g,"/").replace(/^\/|\/$/g,"").split("/").filter(e=>""!=e);return 0===n.length?"pages/blog/index.html":{canonicalRoute:"/blog/"+n.join("/")+"/",template:"pages/blog/"+n.join(".")+".html"}},route:"/blog(/.*)*"}).on("load",()=>{})}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}window.json={},n(907),n(357),json.world=n(692),yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",()=>{})})();